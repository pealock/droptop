---

- hosts: all
  become: true
  tasks:

  - name: Update repos, upgrade packages, install utilities
    apt:
      name:
        - chromium
        - chromium-chromedriver
        - git
        - pip
      state: latest
      update_cache: yes
      upgrade: full

  - name: Create python3 virtualenv
    command:
      cmd: python -m venv /var/.py
      creates: "/var/.py"

  - name: Install pip modules
    pip:
      name:
      - selenium
      - python-dotenv
      virtualenv: /var/.py

  - name: Create app directory
    ansible.builtin.file:
      path: /var/app/
      state: directory
      mode: '0755'

  - name: Git clone droptop repo
    ansible.builtin.git:
      repo: https://github.com/pealock/droptop.git
      dest: /var/app/

  - name: Create .env file with droptop credentials
    copy:
      dest: /var/app/.env
      content: |
        EMAIL="{{ username }}"
        PASSWORD="{{ password }}"
  






